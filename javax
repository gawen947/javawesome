#!/usr/bin/env zsh

# default option
SIZE=""
WM=""

# load configuration
if [ -e ~/.javawesomerc ]
then
  source ~/.javawesomerc
fi

# setup configuration
if [ $SIZE ]
then
  screen_arg="-screen"
fi
num=`echo $DISPLAY | awk -F "" '{print $2}'`
screen=`echo $DISPLAY | awk -F "" '{print $4}'` 
new_num=`expr $num + 1`
if [ `pidof Xephyr`]
then
    echo "another instance of Xephyr exists (pid=$test)"
else
    {(Xephyr -ac ":$new_num" $screen_arg $SIZE -reset -terminate &> /dev/null) &;
      xpid=$!
      sleep 0.1s;
      export DISPLAY=":$new_num.$screen";

      if [ $WM ]
      then
        $WM &
      fi
	  if [[ $1 == "-p" ]]
	  then
		  $2
	  else
		  java $*
	  fi
      export DISPLAY=":$num.$screen";
      wait $xpid
    }
fi
